# MCP 初心者ガイド（日本語版）

## Model Context Protocol (MCP)とは？

Model Context Protocol (MCP)は、AIアシスタントを外部のツールやデータソースに接続するための革新的な標準です。MCPを「橋」として考えると、Claude、ChatGPT、その他のAIシステムがローカルファイル、API、データベース、アプリケーションと相互作用できるようになります。

### MCPの重要性

MCPが登場する前、AIアシスタントはテキストのみの会話に制限されていました。MCPにより、AIは以下が可能になります：

- **コマンドの実行** コンピューター上でのコマンド実行
- **ファイルの読み書き** プロジェクトでのファイル操作
- **APIの呼び出し** データの取得や送信
- **データベースへのアクセス** その他のデータソースへのアクセス
- **専用ツールの使用** コードフォーマッター、コンパイラー、カスタムアプリケーションなど

## MCPの仕組み

MCPはクライアント・サーバーアーキテクチャを使用します：

```
AIアシスタント（クライアント） ←→ MCPサーバー ←→ あなたのツール/データ
     (Claude)              （我々のサーバー）    (Notion API)
```

### コンポーネント

1. **MCPクライアント**: AIアシスタント（Claude Desktopなど）
2. **MCPサーバー**: 特定のツールを提供するプログラム
3. **ツール**: AIが呼び出せる関数（ファイルアップロードなど）
4. **リソース**: AIがアクセスできるデータ（ファイルの内容など）

### 通信フロー

```
1. あなたがAIに依頼: 「ノートをNotionにアップロードして」
   ↓
2. AIがupload_markdownツールが必要と判断
   ↓  
3. AI がMCPサーバーを呼び出し: upload_markdown(filepath="/path/to/notes.md", ...)
   ↓
4. MCPサーバーがリクエストを処理してNotion APIを呼び出し
   ↓
5. MCPサーバーが成功メッセージをAIに返す
   ↓
6. AIが結果を表示: 「Notionにアップロードしました [URL]」
```

## MCPのセットアップ（ステップバイステップ）

### 前提条件

- MCP対応AIアシスタント（Claude Desktop、Clineなど）
- Python 3.8以上
- 基本的なコマンドライン知識

### インストール手順

#### 1. MCPサーバーのインストール

```bash
# リポジトリをクローン
git clone https://github.com/your-username/markdown2notion.git
cd markdown2notion

# 依存関係をインストール
pip install -e .
```

#### 2. Notionインテグレーションの設定

1. [Notion Integrations](https://www.notion.so/my-integrations) にアクセス
2. 「New integration」をクリック
3. 名前を付ける: 「Markdown2Notion」
4. 「Internal Integration Token」をコピー
5. `.env` ファイルを作成:

```bash
echo "NOTION_TOKEN=your_token_here" > .env
```

#### 3. Notion権限の付与

1. 対象のNotionページを開く
2. 「...」メニュー → 「接続を追加」をクリック
3. 「Markdown2Notion」を検索して選択
4. 「確認」をクリック

#### 4. AIクライアントの設定

Claude Desktop用（`cline_mcp_settings.json`）:

```json
{
  "mcpServers": {
    "markdown2notion": {
      "command": "python",
      "args": ["/full/path/to/markdown2notion/src/server.py"]
    }
  }
}
```

#### 5. セットアップのテスト

AIクライアントを再起動して試してください：
> 「このマークダウンファイルを Notion ワークスペースにアップロードしてください: /path/to/file.md 親ページは https://notion.so/my-page を使ってください」

## MCPツールの理解

### ツールとは？

ツールはAIアシスタントが呼び出せる関数です。各ツールには以下があります：

- **名前**: `upload_markdown` のような
- **説明**: 何をするか
- **パラメータ**: 必要な入力
- **戻り値**: 何を返すか

### 我々のツールの説明

#### upload_markdown

**何をするか**: MarkdownファイルをNotionページに変換

**なぜ便利か**: 
- コピー・ペーストの時間を節約
- フォーマットを自動で保持
- 大容量ファイル（100セクション以上）を処理
- 適切なNotionブロックを作成

**会話例**:
> **あなた**: 「プロジェクト文書をNotionにアップロードして」
> 
> **AI**: 「MarkdownファイルをNotionにアップロードできます。ファイルパスと親ページはどちらですか？」
> 
> **あなた**: 「ファイルは /Users/me/docs/project.md で親ページは https://notion.so/my-workspace/abc123 です」
> 
> **AI**: *upload_markdownツールを呼び出し* 「'project.md'をNotionにアップロードしました！こちらで確認できます: https://notion.so/def456」

## 一般的なMCPの概念

### 環境変数

多くのMCPサーバーは設定に環境変数を使用します：

```bash
# .env ファイル内
NOTION_TOKEN=secret_token_here
API_KEY=another_secret
DATABASE_URL=connection_string
```

**理由**: 秘密情報をコードから分離し、設定を柔軟にするため。

### エラーハンドリング

MCPツールは様々な理由で失敗する可能性があります：

- **ファイルが見つからない**: ファイルパスを確認
- **アクセス拒否**: APIトークンとアクセス権を確認
- **ネットワークエラー**: インターネット接続を確認
- **無効なパラメータ**: ツールの文書を確認

## ベストプラクティス

### セキュリティ

1. **トークンを共有しない**: `.env` ファイルを非公開に
2. **特定の権限を使用**: 最小限必要なアクセス権のみ付与
3. **定期的なローテーション**: APIトークンを定期的に更新

### ファイルパス

1. **絶対パスを使用**: `./file.md` の代わりに `/full/path/to/file.md`
2. **存在確認**: 参照前にファイルが存在することを確認
3. **スペースの処理**: スペース付きパスは引用符で囲む

## トラブルシューティングガイド

### 「ツールが見つからない」エラー

**問題**: AIがMCPツールを知らないと言う

**解決方法**:
- AIクライアントを再起動
- MCPサーバーの設定を確認
- サーバーが実行中か確認

### 「アクセス拒否」エラー

**問題**: Notion/ファイルにアクセスできない

**解決方法**:
- Notionインテグレーション権限を確認
- ファイルシステム権限を確認
- APIトークンが正しいか確認

### 「無効なURL」エラー

**問題**: Notion URL形式が認識されない

**解決方法**:
- 完全なURLを使用: `https://notion.so/page-title-id`
- ブラウザのアドレスバーからコピー
- ワークスペース固有のURLは使用しない

## 高度な使用法

### バッチ操作

基本を理解したら、より複雑な操作が可能です：

> 「/docs フォルダ内のすべての .md ファイルを [URL] のNotionページにアップロードして、各ファイルに対して個別のページを作成してください」

### 他のツールとの統合

MCPサーバーは連携できます：

> 「コードベースからAPIドキュメントを読み取り、要約して、Notionナレッジベースにアップロードしてください」

## 次のステップ

1. **基本アップロードを試す**: シンプルなMarkdownファイルから開始
2. **パラメータを探索**: 異なる親ページとデータベースを試す
3. **APIドキュメントを読む**: 利用可能なすべてのツールを理解
4. **ワークフローを構築**: 独自の自動化パターンを作成
5. **貢献**: ツールの改善や新機能作成を支援

## ヘルプの取得

- **ドキュメント**: 詳細ガイドについては `/docs` フォルダを確認
- **エラーメッセージ**: 注意深く読む - 通常は有用
- **コミュニティ**: 他のMCPユーザーと経験を共有
- **GitHub Issues**: バグ報告や機能リクエスト

覚えておいてください：MCPはAIアシスタントをより便利にするために、あなたのツールとデータへのアクセスを提供することです。シンプルに始め、概念に慣れながら徐々に学習し、複雑なワークフローに発展させてください。